<!--adminusermanagement.html-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MJIIT RoomMaster - Admin User Management</title>
    <link rel="stylesheet" href="styles2.css">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <header>
        <div class="logo-container">
            <div class="logo">
                <img src="UTM-LOGO-FULL.png" alt="UTM Logo">
                <img src="Mjiit RoomMaster logo.png" alt="MJIIT RoomMaster Logo">
                <span class="booking-space">BookingSpace</span>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="dashboard.php"><b>Dashboard</b></a></li>
                <li><a href="booking.php"><b>Booking</b></a></li>
                <li><a href="users.php" class="active"><b>Users</b></a></li>
                <li><a href="rooms.php"><b>Rooms</b></a></li>
                <li><a href="analytics.php"><b>Analytics</b></a></li>
                <li><a href="help.php"><b>Help</b></a></li>
            </ul>
        </nav>
        <div class="user-info">
            <i class="fas fa-user-circle"></i>
            <span class="admin-badge"><i class="fas fa-user-shield"></i> <b>Admin</b></span>
        </div>
    </header>

    <main>
        <div class="page-header">
            <h1>User Management</h1>
            <p>Manage your team members and their account permission here</p>
        </div>

        <div class="content-container">
            <div class="user-management-header">
                <h2 class="section-title">All Users <span class="user-count">19</span></h2>
                <div class="action-buttons">
                    <button class="filter-btn">
                        <i class="fas fa-filter"></i> &nbsp; Filters
                    </button>
                    <button class="add-user-btn">
                        <i class="fas fa-plus"></i> Add User
                    </button>
                </div>
            </div>

            <div class="search-box">
                <input type="text" placeholder="Search users by name or email...">
                <button class="search-btn">Search</button>
            </div>

            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th></th>
                            <th>User Name</th>
                            <th>Access</th>
                            <th>Last Active</th>
                            <th>Date Added</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>AMIRUL QAYYUM</strong><br>
                                    amirulqayyum@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag admin">Admin</span>
                                <a href="dataimport.html" class="access-tag data-import" style="text-decoration: none;">Data Import</a>
                                <a href="dataexport.html" class="access-tag data-export" style="text-decoration: none;">Data Export</a>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>SAHIL</strong><br>
                                    sahil@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag admin">Admin</span>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>TAHSIN</strong><br>
                                    tahsin@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag admin">Admin</span>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>RIFAH</strong><br>
                                    rifah@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag admin">Admin</span>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>FATHIYA</strong><br>
                                    fathiya@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag admin">Admin</span>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>AHMAD</strong><br>
                                    ahmad@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                                <span class="access-tag delete-user"><i class="fas fa-times"></i> Delete User</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>ALICE</strong><br>
                                    Alice@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                                <span class="access-tag delete-user"><i class="fas fa-times"></i> Delete User</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                        <tr>
                            <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
                            <td>
                                <div>
                                    <strong>PUTERI</strong><br>
                                    puteri@graduate.utm.my
                                </div>
                            </td>
                            <td>
                                <span class="access-tag data-import">Data Import</span>
                                <span class="access-tag data-export">Data Export</span>
                                <span class="access-tag delete-user"><i class="fas fa-times"></i> Delete User</span>
                            </td>
                            <td>NOV 6, 2024</td>
                            <td>JUN 6, 2024</td>
                        </tr>
                    </tbody>
                </table>
            </div>

            <div class="pagination">
                <button class="prev-btn">&lt;</button>
                <span>1</span>
                <span>of</span>
                <span>3</span>
                <button class="next-btn">&gt;</button>
            </div>
        </div>
        <div id="addUserModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Add New User</h2>
                <form id="addUserForm">
                    <div class="form-group">
                        <label for="userName">Full Name:</label>
                        <input type="text" id="userName" name="userName" required>
                    </div>
                    <div class="form-group">
                        <label for="userEmail">Email:</label>
                        <input type="email" id="userEmail" name="userEmail" required 
                               pattern=".*@graduate\.utm\.my$" 
                               title="Please use a valid UTM graduate email address">
                    </div>
                    <div class="form-group">
                        <label>Access Level:</label>
                        <div class="checkbox-group">
                            <label>
                                <input type="checkbox" name="access" value="admin"> Admin
                            </label>
                            <label>
                                <input type="checkbox" name="access" value="dataImport"> Data Import
                            </label>
                            <label>
                                <input type="checkbox" name="access" value="dataExport"> Data Export
                            </label>
                        </div>
                    </div>
                    <button type="submit" class="submit-btn">Add User</button>
                </form>
            </div>
        </div>
        <div id="deleteConfirmModal" class="modal">
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Confirm Delete</h2>
                <p>Are you sure you want to delete this user? This action cannot be undone.</p>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button id="confirmDelete" class="submit-btn" style="background-color: #DC3545;">Delete</button>
                    <button id="cancelDelete" class="submit-btn" style="background-color: #6c757d;">Cancel</button>
                </div>
            </div>
        </div>
    </main>

    <footer>
        <p>&copy; 2024 MJIIT BookingSpace - Admin Portal</p>
    </footer>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
    // Get all DOM elements needed for filtering and searching
    const searchInput = document.querySelector('.search-box input');
    const searchButton = document.querySelector('.search-btn');
    const filterButton = document.querySelector('.filter-btn');
    const tbody = document.querySelector('table tbody');
    const rows = Array.from(tbody.querySelectorAll('tr'));

    // Filter modal (we'll create this dynamically)
    const filterModal = createFilterModal();
    document.body.appendChild(filterModal);

    // Search functionality
    function performSearch() {
        const searchTerm = searchInput.value.toLowerCase().trim();
        
        rows.forEach(row => {
            const userName = row.querySelector('strong').textContent.toLowerCase();
            const userEmail = row.querySelector('td div').textContent.toLowerCase();
            
            const isVisible = userName.includes(searchTerm) || userEmail.includes(searchTerm);
            row.style.display = isVisible ? '' : 'none';
        });
    }

    // Add event listeners for search
    searchInput.addEventListener('input', performSearch);
    searchButton.addEventListener('click', performSearch);

    // Filter modal creation
    function createFilterModal() {
        const modal = document.createElement('div');
        modal.classList.add('modal', 'filter-modal');
        modal.innerHTML = `
            <div class="modal-content">
                <span class="close">&times;</span>
                <h2>Filter Users</h2>
                <div class="filter-section">
                    <h3>Access Level</h3>
                    <div class="checkbox-group">
                        <label>
                            <input type="checkbox" name="accessFilter" value="admin"> Admin
                        </label>
                        <label>
                            <input type="checkbox" name="accessFilter" value="dataImport"> Data Import
                        </label>
                        <label>
                            <input type="checkbox" name="accessFilter" value="dataExport"> Data Export
                        </label>
                    </div>
                </div>
                <div class="filter-section">
                    <h3>Date Range</h3>
                    <div class="date-range">
                        <label>From:</label>
                        <input type="date" id="dateFrom">
                        <label>To:</label>
                        <input type="date" id="dateTo">
                    </div>
                </div>
                <button id="applyFilters" class="submit-btn">Apply Filters</button>
            </div>
        `;

        // Close button functionality
        const closeBtn = modal.querySelector('.close');
        closeBtn.addEventListener('click', () => {
            modal.style.display = 'none';
        });

        // Apply filters functionality
        const applyFiltersBtn = modal.querySelector('#applyFilters');
        applyFiltersBtn.addEventListener('click', () => {
            applyUserFilters();
            modal.style.display = 'none';
        });

        return modal;
    }

    // Filter button click to show modal
    filterButton.addEventListener('click', () => {
        filterModal.style.display = 'block';
    });

    // Apply filters function
    function applyUserFilters() {
        // Get selected access levels
        const selectedAccessLevels = Array.from(
            document.querySelectorAll('input[name="accessFilter"]:checked')
        ).map(cb => cb.value);

        // Get date range
        const dateFrom = document.getElementById('dateFrom').value;
        const dateTo = document.getElementById('dateTo').value;

        // Filter rows
        rows.forEach(row => {
            // Check access level filter
            const accessTags = row.querySelectorAll('.access-tag');
            const hasSelectedAccess = selectedAccessLevels.length === 0 || 
                selectedAccessLevels.some(level => 
                    Array.from(accessTags).some(tag => tag.textContent.toLowerCase().includes(level))
                );

            // Check date filter
            const dateAdded = row.querySelectorAll('td')[4].textContent;
            const rowDate = new Date(dateAdded);
            
            const fromDate = dateFrom ? new Date(dateFrom) : null;
            const toDate = dateTo ? new Date(dateTo) : null;

            const isInDateRange = (!fromDate || rowDate >= fromDate) && 
                                  (!toDate || rowDate <= toDate);

            // Apply visibility
            row.style.display = (hasSelectedAccess && isInDateRange) ? '' : 'none';
        });
    }

    // Add styles for filter modal
    const filterModalStyle = document.createElement('style');
    filterModalStyle.textContent = `
        .filter-modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.4);
        }

        .filter-modal .modal-content {
            background-color: #fefefe;
            margin: 15% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 500px;
            border-radius: 8px;
        }

        .filter-modal .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .filter-modal .close:hover {
            color: black;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section h3 {
            margin-bottom: 10px;
        }

        .checkbox-group, .date-range {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
    `;
    document.head.appendChild(filterModalStyle);
});
        // Handle clicks on data import/export tags
        document.addEventListener('DOMContentLoaded', function() {
            // Get all access tags
            const dataImportTags = document.querySelectorAll('.access-tag.data-import');
            const dataExportTags = document.querySelectorAll('.access-tag.data-export');
    
            // Add click handlers for data import tags
            dataImportTags.forEach(tag => {
                tag.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.location.href = 'dataimport.html';
                });
            });
    
            // Add click handlers for data export tags
            dataExportTags.forEach(tag => {
                tag.addEventListener('click', function(e) {
                    e.preventDefault();
                    window.location.href = 'dataexport.html';
                });
            });
        });
    </script>
    <script>
// Get modal elements
const addUserModal = document.getElementById('addUserModal');
const deleteConfirmModal = document.getElementById('deleteConfirmModal');
const addUserBtn = document.querySelector('.add-user-btn');
const closeBtns = document.querySelectorAll('.close');
const addUserForm = document.getElementById('addUserForm');

// Variables to store current user being deleted
let currentDeleteUser = null;

// Show Add User modal
addUserBtn.onclick = function() {
    addUserModal.style.display = "block";
}

// Close modals when clicking (x)
closeBtns.forEach(btn => {
    btn.onclick = function() {
        addUserModal.style.display = "none";
        deleteConfirmModal.style.display = "none";
    }
});

// Close modals when clicking outside
window.onclick = function(event) {
    if (event.target == addUserModal || event.target == deleteConfirmModal) {
        addUserModal.style.display = "none";
        deleteConfirmModal.style.display = "none";
    }
}

// Handle Add User form submission
addUserForm.onsubmit = function(e) {
    e.preventDefault();
    
    // Get form data
    const formData = {
        name: document.getElementById('userName').value,
        email: document.getElementById('userEmail').value,
        access: Array.from(document.querySelectorAll('input[name="access"]:checked'))
                    .map(checkbox => checkbox.value)
    };

    // Here you would typically make an AJAX call to your backend
    // For demonstration, we'll add the user directly to the table
    addUserToTable(formData);
    
    // Clear form and close modal
    addUserForm.reset();
    addUserModal.style.display = "none";
}

// Function to add user to table
function addUserToTable(userData) {
    const tbody = document.querySelector('table tbody');
    const newRow = document.createElement('tr');
    
    // Get current date for "Date Added"
    const currentDate = new Date();
    const dateAdded = currentDate.toLocaleDateString('en-US', { 
        month: 'short', 
        day: 'numeric', 
        year: 'numeric'
    }).toUpperCase();

    // Create access tags HTML
    const accessTags = userData.access.map(access => {
        let className = '';
        let text = '';
        
        switch(access) {
            case 'admin':
                className = 'admin';
                text = 'Admin';
                break;
            case 'dataImport':
                className = 'data-import';
                text = 'Data Import';
                break;
            case 'dataExport':
                className = 'data-export';
                text = 'Data Export';
                break;
        }
        
        return `<span class="access-tag ${className}">${text}</span>`;
    }).join('');

    // Add delete tag if user is not admin
    if (!userData.access.includes('admin')) {
        accessTags += `
            <span class="access-tag delete-user">
                <i class="fas fa-times"></i> Delete User
            </span>`;
    }

    newRow.innerHTML = `
        <td><input type="checkbox"><i class="fas fa-user" style="margin-left: 8px; color: #666;"></i></td>
        <td>
            <div>
                <strong>${userData.name}</strong><br>
                ${userData.email}
            </div>
        </td>
        <td>${accessTags}</td>
        <td>${dateAdded}</td>
        <td>${dateAdded}</td>
    `;

    tbody.insertBefore(newRow, tbody.firstChild);
    attachDeleteHandlers();
}

// Function to handle delete user
function attachDeleteHandlers() {
    const deleteButtons = document.querySelectorAll('.access-tag.delete-user');
    
    deleteButtons.forEach(button => {
        button.onclick = function() {
            // Store reference to user being deleted
            currentDeleteUser = this.closest('tr');
            deleteConfirmModal.style.display = "block";
        }
    });
}

// Handle delete confirmation
document.getElementById('confirmDelete').onclick = function() {
    if (currentDeleteUser) {
        // Here you would typically make an AJAX call to your backend
        // For demonstration, we'll just remove the row
        currentDeleteUser.remove();
        currentDeleteUser = null;
        deleteConfirmModal.style.display = "none";
    }
}

// Handle delete cancellation
document.getElementById('cancelDelete').onclick = function() {
    currentDeleteUser = null;
    deleteConfirmModal.style.display = "none";
}

// Initial attachment of delete handlers
attachDeleteHandlers();
</script>
</body>
</html>
